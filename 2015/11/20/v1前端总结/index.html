<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Angular,代码规范,总结," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.0" />






<meta name="description" content="前言v1磕磕盼盼总算差不多了，但转头看确不忍直视。有太多东西需要我们去思考。

代码风格">
<meta property="og:type" content="article">
<meta property="og:title" content="v1前端总结">
<meta property="og:url" content="http://yoursite.com/2015/11/20/v1前端总结/index.html">
<meta property="og:site_name" content="Levy@">
<meta property="og:description" content="前言v1磕磕盼盼总算差不多了，但转头看确不忍直视。有太多东西需要我们去思考。

代码风格">
<meta property="og:updated_time" content="2015-11-21T13:20:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="v1前端总结">
<meta name="twitter:description" content="前言v1磕磕盼盼总算差不多了，但转头看确不忍直视。有太多东西需要我们去思考。

代码风格">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: '[object Object]',
    fancybox: true,
    motion: true
  };
</script>

  <title> v1前端总结 | Levy@ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Levy@</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">养的胸中一种恬静</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                v1前端总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-20T17:07:14+08:00" content="2015-11-20">
              2015-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<h2 id="前言">前言</h2><p>v1磕磕盼盼总算差不多了，但转头看确不忍直视。有太多东西需要我们去思考。</p>
</blockquote>
<h2 id="代码风格">代码风格</h2><a id="more"></a>
<h3 id="文件">文件</h3><p>[建议] <code>JavaScript</code> 文件使用无 <code>BOM</code> 的 <code>UTF-8</code> 编码。</p>
<p>解释：</p>
<p>UTF-8 编码具有更广泛的适应性。BOM 在使用程序或工具处理文件时可能造成不必要的干扰。</p>
<p>[建议] 在文件结尾处，保留一个空行。</p>
<h3 id="命名">命名</h3><p><strong>[强制] 变量 使用 Camel命名法。</strong></p>
<p>示例：</p>
<pre><code><span class="variable"><span class="keyword">var</span> loadingModules</span> = {};
</code></pre><p><strong>[强制] 常量 使用 全部字母大写，单词间下划线分隔 的命名方式。</strong></p>
<p>示例：</p>
<pre><code><span class="variable"><span class="keyword">var</span> HTML_ENTITY</span> = {};
</code></pre><p><strong>[强制] 函数 使用 Camel命名法。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">stringFormat</span><span class="params">(source)</span> </span>{
}
</code></pre><p><strong>[强制] 函数的 参数 使用 Camel命名法。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">hear</span><span class="params">(theBells)</span> </span>{
}
</code></pre><p><strong>[强制] 类 使用 Pascal命名法。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">TextNode</span><span class="params">(options)</span> </span>{
}
</code></pre><p><strong>[强制] 类的 方法 / 属性 使用 Camel命名法。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">TextNode</span><span class="params">(value, engine)</span> </span>{
    <span class="keyword">this</span>.value = value;
    <span class="keyword">this</span>.engine = engine;
}

TextNode.prototype.clone = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
    <span class="keyword">return</span> <span class="keyword">this</span>;
};
</code></pre><p><strong>[强制] <code>枚举变量</code> 使用 <code>Pascal命名法</code>，<code>枚举的属性</code> 使用 <code>全部字母大写，单词间下划线分隔</code> 的命名方式。</strong></p>
<p>示例：</p>
<pre><code>var TargetState = {
    READING: <span class="number">1</span>,
    READED: <span class="number">2</span>,
    APPLIED: <span class="number">3</span>,
    READY: <span class="number">4</span>
};
</code></pre><p><strong>[强制] <code>命名空间</code> 使用 <code>Camel命名法</code>。</strong></p>
<p>示例：</p>
<pre><code>equipments.heavyWeapons = {}<span class="comment">;</span>
</code></pre><p><strong>[强制] 由多个单词组成的缩写词，在命名中，根据当前命名法和出现的位置，所有字母的大小写与首字母的大小写保持一致。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">XMLParser</span><span class="params">()</span> </span>{
}

<span class="function"><span class="keyword">function</span> <span class="title">insertHTML</span><span class="params">(element, html)</span> </span>{
}

<span class="keyword">var</span> httpRequest = <span class="keyword">new</span> HTTPRequest();
</code></pre><p><strong>[强制] <code>类名</code> 使用 <code>名词</code>。</strong></p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">Engine</span><span class="params">(options)</span> </span>{
}
</code></pre><p>[建议] <code>函数名</code> 使用 <code>动宾短语</code>。</p>
<p>示例：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">getStyle</span><span class="params">(element)</span> </span>{
}
</code></pre><p>[建议] <code>boolean</code> 类型的变量使用 <code>is</code> 或 <code>has</code> 开头。</p>
<p>示例：</p>
<pre><code><span class="variable"><span class="keyword">var</span> isReady</span> = <span class="literal">false</span>;
<span class="variable"><span class="keyword">var</span> hasMoreCommands</span> = <span class="literal">false</span>;
</code></pre><p><strong>[建议] <code>Promise对象</code> 用 <code>动宾短语的进行时</code> 表达。</strong></p>
<p>示例：</p>
<pre><code><span class="keyword">var</span> loadingData = ajax.<span class="keyword">get</span>(<span class="string">'url'</span>);
loadingData.then(callback);
</code></pre><h3 id="注释">注释</h3><h4 id="单行注释">单行注释</h4><p><strong>[强制] 必须独占一行。// 后跟一个空格，缩进与下一行被注释说明的代码一致。</strong></p>
<h4 id="多行注释">多行注释</h4><p>[建议] 避免使用 <code>/*...*/</code> 这样的多行注释。有多行注释内容时，使用多个单行注释。</p>
<h4 id="文档化注释">文档化注释</h4><p><strong>[强制] 为了便于代码阅读和自文档化，以下内容必须包含以 <code>/**...*/</code> 形式的块注释中。</strong><br>解释：</p>
<ol>
<li>文件</li>
<li>namespace</li>
<li>类</li>
<li>函数或方法</li>
<li>类属性</li>
<li>事件</li>
<li>全局变量</li>
<li>常量</li>
<li>AMD 模块</li>
</ol>
<p><strong>[强制] 文档注释前必须空一行。</strong></p>
<p>[建议] 自文档化的文档说明 what，而不是 how。</p>
<h4 id="类型定义">类型定义</h4><p><strong>[强制] 类型定义都是以<code>{</code>开始, 以<code>}</code>结束。</strong></p>
<p>解释：</p>
<p>常用类型如：{string}, {number}, {boolean}, {Object}, {Function}, {RegExp}, {Array}, {Date}。</p>
<p>类型不仅局限于内置的类型，也可以是自定义的类型。比如定义了一个类 Developer，就可以使用它来定义一个参数和返回值的类型。</p>
<p><strong>[强制] 对于基本类型 {string}, {number}, {boolean}，首字母必须小写。</strong></p>
<table>
<thead>
<tr>
<th>类型定义</th>
<th>语法实例</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td> String</td>
<td>{string}</td>
<td>- </td>
</tr>
<tr>
<td> Number</td>
<td>{number}</td>
<td>- </td>
</tr>
<tr>
<td> Boolean</td>
<td>{boolean}</td>
<td>- </td>
</tr>
<tr>
<td> Object</td>
<td>{Object}</td>
<td>- </td>
</tr>
<tr>
<td> Function</td>
<td>{Function}</td>
<td>- </td>
</tr>
<tr>
<td> RegExp</td>
<td>{RegExp}</td>
<td>- </td>
</tr>
<tr>
<td> Array</td>
<td>{Array}</td>
<td>- </td>
</tr>
<tr>
<td> Date</td>
<td>{Date}</td>
<td>- </td>
</tr>
<tr>
<td> 单一类型集合</td>
<td>{Array.<string>}</string></td>
<td>string类型的数组 </td>
</tr>
<tr>
<td> 多类型</td>
<td>{(number &brvbar; boolean)}</td>
<td>可能是number类也可能是boolean类型 </td>
</tr>
<tr>
<td> 允许为null</td>
<td>{?number}</td>
<td>可能是number,也可能是null </td>
</tr>
<tr>
<td> 不允许为null</td>
<td>{!Object}</td>
<td>Object 类型, 但不是 null </td>
</tr>
<tr>
<td> Function类型</td>
<td>{function(number,boolean)}</td>
<td>函数，形参类型 </td>
</tr>
<tr>
<td> Function带返回值</td>
<td>{function(number,boolean):string}</td>
<td>函数，形参，返回类型 </td>
</tr>
<tr>
<td> 参数可选</td>
<td>@param {string=} name</td>
<td>可选参数，=为类型后缀 </td>
</tr>
<tr>
<td> 可变参数</td>
<td>@param {…numeber} args</td>
<td>变长参数，…为类型前缀 </td>
</tr>
<tr>
<td> 任意类型</td>
<td>{*}</td>
<td>任意类型 </td>
</tr>
<tr>
<td> 可选任意类型</td>
<td>@param {*=} name</td>
<td>可选参数，类型不限 </td>
</tr>
<tr>
<td> 可变任意类型</td>
<td>@param {…*} args</td>
<td>变长参数，类型不限 </td>
</tr>
</tbody>
</table>
<h4 id="文件注释">文件注释</h4><p><strong>[强制] 文件顶部必须包含文件注释，用 <code>@file</code> 标识文件说明。</strong></p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@file Describe the file</span>
 <span class="keyword">*</span>/
</code></pre><p>[建议] 文件注释中可以用 <code>@author</code> 标识开发者信息。</p>
<p>解释：</p>
<p>开发者信息能够体现开发人员对文件的贡献，并且能够让遇到问题或希望了解相关信息的人找到维护人。通常情况文件在被创建时标识的是创建者。随着项目的进展，越来越多的人加入，参与这个文件的开发，新的作者应该被加入 <code>@author</code> 标识。</p>
<p><code>@author</code> 标识具有多人时，原则是按照 责任 进行排序。通常的说就是如果有问题，就是找第一个人应该比找第二个人有效。比如文件的创建者由于各种原因，模块移交给了其他人或其他团队，后来因为新增需求，其他人在新增代码时，添加 <code>@author</code> 标识应该把自己的名字添加在创建人的前面。</p>
<p><code>@author</code> 中的名字不允许被删除。任何劳动成果都应该被尊重。</p>
<p>业务项目中，一个文件可能被多人频繁修改，并且每个人的维护时间都可能不会很长，不建议为文件增加 <code>@author</code> 标识。通过版本控制系统追踪变更，按业务逻辑单元确定模块的维护责任人，通过文档与wiki跟踪和查询，是更好的责任管理方式。</p>
<p>对于业务逻辑无关的技术型基础项目，特别是开源的公共项目，应使用 <code>@author</code> 标识。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@file Describe the file</span>
 <span class="keyword">*</span> <span class="comment">@author author-name(mail-name@domain.com)</span>
 <span class="keyword">*</span>         author-name2(mail-name2<span class="comment">@domain.com)</span>
 <span class="keyword">*</span>/
</code></pre><h4 id="命名空间注释">命名空间注释</h4><p>[建议] 命名空间使用 <code>@namespace</code> 标识。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@namespace</span>
 <span class="keyword">*</span>/
var util = {};
</code></pre><h4 id="类注释">类注释</h4><p>[建议] 使用 <code>@class</code> 标记类或构造函数。</p>
<p>解释：</p>
<p>对于使用对象 <code>constructor</code> 属性来定义的构造函数，可以使用 <code>@constructor</code> 来标记。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 描述
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@class</span>
 <span class="keyword">*</span>/
function Developer() {
    // constructor body
}
</code></pre><p>[建议] 使用 <code>@extends</code> 标记类的继承信息。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 描述
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@class</span>
 <span class="keyword">*</span> <span class="comment">@extends Developer</span>
 <span class="keyword">*</span>/
function Fronteer() {
    Developer.call(this);
    // constructor body
}
util.inherits(Fronteer, Developer);
</code></pre><p><strong>[强制] 使用包装方式扩展类成员时， 必须通过 <code>@lends</code> 进行重新指向。</strong></p>
<p>解释：</p>
<p>没有 <code>@lends</code> 标记将无法为该类生成包含扩展类成员的文档。</p>
<p>示例：</p>
<pre><code><span class="comment">/**
 * 类描述
 *
 * <span class="doctag">@class</span>
 * <span class="doctag">@extends</span> Developer
 */</span>
<span class="function"><span class="keyword">function</span> <span class="title">Fronteer</span><span class="params">()</span> </span>{
    Developer.call(this);
    <span class="comment">// constructor body</span>
}

util.extend(
    Fronteer.prototype,
    <span class="comment">/** <span class="doctag">@lends</span> Fronteer.prototype */</span>{
        _getLevel: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
            <span class="comment">// TODO</span>
        }
    }
);
</code></pre><p><strong>[强制] 类的属性或方法等成员信息使用 <code>@public</code> / <code>@protected</code> / <code>@private</code> 中的任意一个，指明可访问性。</strong></p>
<p>解释：</p>
<p>生成的文档中将有可访问性的标记，避免用户直接使用非 <code>public</code> 的属性或方法。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 类描述
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@class</span>
 <span class="keyword">*</span> <span class="comment">@extends Developer</span>
 <span class="keyword">*</span>/
var Fronteer = function () {
    Developer.call(this);

    /<span class="keyword">*</span><span class="keyword">*</span>
     <span class="keyword">*</span> 属性描述
     <span class="keyword">*</span>
     <span class="keyword">*</span> <span class="comment">@type {string}</span>
     <span class="keyword">*</span> <span class="comment">@private</span>
     <span class="keyword">*</span>/
    this._level = 'T12';

    // constructor body
};
util.inherits(Fronteer, Developer);

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 方法描述
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@private</span>
 <span class="keyword">*</span> <span class="comment">@return {string} 返回值描述</span>
 <span class="keyword">*</span>/
Fronteer.prototype._getLevel = function () {
};
</code></pre><h4 id="函数/方法注释">函数/方法注释</h4><p><strong>[强制] 函数/方法注释必须包含函数说明，有参数和返回值时必须使用注释标识。</strong></p>
<p><strong>[强制] 参数和返回值注释必须包含类型信息和说明。</strong></p>
<p>[建议] 当函数是内部函数，外部不可访问时，可以使用 <code>@inner</code> 标识。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 函数描述
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@param {string} p1 参数1的说明</span>
 <span class="keyword">*</span> <span class="comment">@param {string} p2 参数2的说明，比较长</span>
 <span class="keyword">*</span>     那就换行了.
 <span class="keyword">*</span> <span class="comment">@param {number=} p3 参数3的说明（可选）</span>
 <span class="keyword">*</span> <span class="comment">@return {Object} 返回值描述</span>
 <span class="keyword">*</span>/
function foo(p1, p2, p3) {
    var p3 = p3 ||<span class="string"> 10;
    return {
        p1: p1,
        p2: p2,
        p3: p3
    };
}</span>
</code></pre><p><strong>[强制] 对 Object 中各项的描述， 必须使用 <code>@param</code> 标识。</strong></p>
<p>示例：</p>
<pre><code>/**
 * 函数描述
 *
 * @param {<span class="type">Object</span>} option 参数描述
 * @param {<span class="type">string</span>} option.url option项描述
 * @param {<span class="type">string</span>=} option.<span class="keyword">method</span> option项描述，可选参数
 */
function foo(option) {
    // <span class="type">TODO</span>
}
</code></pre><p><strong>[建议] 重写父类方法时， 应当添加 <code>@override</code> 标识。如果重写的形参个数、类型、顺序和返回值类型均未发生变化，可省略 <code>@param</code>、<code>@return</code>，仅用 <code>@override</code> 标识，否则仍应作完整注释。</strong></p>
<p>解释：</p>
<p>简而言之，当子类重写的方法能直接套用父类的方法注释时可省略对参数与返回值的注释。</p>
<h4 id="事件注释">事件注释</h4><p><strong>[强制] 必须使用 <code>@event</code> 标识事件，事件参数的标识与方法描述的参数标识相同。</strong></p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 值变更时触发
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@event</span>
 <span class="keyword">*</span> <span class="comment">@param {Object} e e描述</span>
 <span class="keyword">*</span> <span class="comment">@param {string} e.before before描述</span>
 <span class="keyword">*</span> <span class="comment">@param {string} e.after after描述</span>
 <span class="keyword">*</span>/
onchange: function (e) {
}
</code></pre><p><strong>[强制] 在会广播事件的函数前使用 <code>@fires</code> 标识广播的事件，在广播事件代码前使用 @event 标识事件。</strong></p>
<p>[建议] 对于事件对象的注释，使用 <code>@param</code> 标识，生成文档时可读性更好。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 点击处理
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@fires Select#change</span>
 <span class="keyword">*</span> <span class="comment">@private</span>
 <span class="keyword">*</span>/
Select.prototype.clickHandler = function () {
    /<span class="keyword">*</span><span class="keyword">*</span>
     <span class="keyword">*</span> 值变更时触发
     <span class="keyword">*</span>
     <span class="keyword">*</span> <span class="comment">@event Select#change</span>
     <span class="keyword">*</span> <span class="comment">@param {Object} e e描述</span>
     <span class="keyword">*</span> <span class="comment">@param {string} e.before before描述</span>
     <span class="keyword">*</span> <span class="comment">@param {string} e.after after描述</span>
     <span class="keyword">*</span>/
    this.fire(
        'change',
        {
            before: 'foo',
            after: 'bar'
        }
    );
};
</code></pre><h4 id="常量注释">常量注释</h4><p><strong>[强制] 常量必须使用 <code>@const</code> 标记，并包含说明和类型信息。</strong></p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 常量说明
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@const</span>
 <span class="keyword">*</span> <span class="comment">@type {string}</span>
 <span class="keyword">*</span>/
var REQUEST_URL = 'myurl.do';
</code></pre><h4 id="复杂类型注释">复杂类型注释</h4><p><strong>[建议] 对于类型未定义的复杂结构的注释，可以使用 <code>@typedef</code> 标识来定义。</strong></p>
<p>示例：</p>
<pre><code>// `namespaceA~` 可以换成其它 namepaths 前缀，目的是为了生成文档中能显示 `<span class="comment">@typedef` 定义的类型和链接。</span>
/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 服务器
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@typedef {Object} namespaceA~Server</span>
 <span class="keyword">*</span> <span class="comment">@property {string} host 主机</span>
 <span class="keyword">*</span> <span class="comment">@property {number} port 端口</span>
 <span class="keyword">*</span>/

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 服务器列表
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@type {Array.&lt;namespaceA~Server&gt;}</span>
 <span class="keyword">*</span>/
var servers = [
    {
        host: '1.2.3.4',
        port: 8080
    },
    {
        host: '1.2.3.5',
        port: 8081
    }
];
</code></pre><h4 id="AMD_模块注释">AMD 模块注释</h4><p><strong>[强制] AMD 模块使用 <code>@module</code> 或 <code>@exports</code> 标识。</strong></p>
<p>解释：</p>
<p><code>@exports</code> 与 <code>@module</code> 都可以用来标识模块，区别在于 <code>@module</code> 可以省略模块名称。而只使用 <code>@exports</code> 时在 <code>namepaths</code> 中可以省略 module: 前缀。</p>
<p>示例：</p>
<pre><code>define(
    function (require) {

        /<span class="keyword">*</span><span class="keyword">*</span>
        <span class="keyword">*</span> foo description
         <span class="keyword">*</span>
         <span class="keyword">*</span> <span class="comment">@exports Foo</span>
         <span class="keyword">*</span>/
        var foo = {
            // TODO
        };

        /<span class="keyword">*</span><span class="keyword">*</span>
        <span class="keyword">*</span> baz description
         <span class="keyword">*</span>
         <span class="keyword">*</span> <span class="comment">@return {boolean} return description</span>
         <span class="keyword">*</span>/
        foo.baz = function () {
            // TODO
        };

        return foo;

    }
);
</code></pre><p>也可以在 <code>exports</code> 变量前使用 <code>@module</code> 标识：</p>
<pre><code>define(
    function (require) {

        /<span class="keyword">*</span><span class="keyword">*</span>
         <span class="keyword">*</span> module description.
         <span class="keyword">*</span>
         <span class="keyword">*</span> <span class="comment">@module foo</span>
         <span class="keyword">*</span>/
        var exports = {};


        /<span class="keyword">*</span><span class="keyword">*</span>
         <span class="keyword">*</span> bar description
         <span class="keyword">*</span>
         <span class="keyword">*</span>/
        exports.bar = function () {
            // TODO
        };

        return exports;
    }
);
</code></pre><p>如果直接使用 <code>factory</code> 的 <code>exports</code> 参数，还可以：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> module description.
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@module</span>
 <span class="keyword">*</span>/
define(
    function (require, exports) {

        /<span class="keyword">*</span><span class="keyword">*</span>
         <span class="keyword">*</span> bar description
         <span class="keyword">*</span>
         <span class="keyword">*</span>/
        exports.bar = function () {
            // TODO
        };
        return exports;
    }
);
</code></pre><p><strong>[强制] 对于已使用 <code>@module</code> 标识为 <code>AMD模块</code> 的引用，在 namepaths 中必须增加 module: 作前缀。</strong></p>
<p>解释：</p>
<p>namepaths 没有 module: 前缀时，生成的文档中将无法正确生成链接。</p>
<p>示例：</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 点击处理
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@fires module:Select#change</span>
 <span class="keyword">*</span> <span class="comment">@private</span>
 <span class="keyword">*</span>/
Select.prototype.clickHandler = function () {
    /<span class="keyword">*</span><span class="keyword">*</span>
     <span class="keyword">*</span> 值变更时触发
     <span class="keyword">*</span>
     <span class="keyword">*</span> <span class="comment">@event module:Select#change</span>
     <span class="keyword">*</span> <span class="comment">@param {Object} e e描述</span>
     <span class="keyword">*</span> <span class="comment">@param {string} e.before before描述</span>
     <span class="keyword">*</span> <span class="comment">@param {string} e.after after描述</span>
     <span class="keyword">*</span>/
    this.fire(
        'change',
        {
            before: 'foo',
            after: 'bar'
        }
    );
};
</code></pre><p><strong>[建议] 对于类定义的模块，可以使用 <code>@alias</code> 标识构建函数。</strong></p>
<p>示例：</p>
<pre><code><span class="comment">/**
 * A module representing a jacket.
 * <span class="doctag">@module</span> jacket
 */</span>
define(
    <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{

        <span class="comment">/**
         * <span class="doctag">@class</span>
         * <span class="doctag">@alias</span> module:jacket
         */</span>
        <span class="keyword">var</span> Jacket = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
        };

        <span class="keyword">return</span> Jacket;
    }
);
</code></pre><p><strong>[建议] 多模块定义时，可以使用 <code>@exports</code> 标识各个模块。</strong></p>
<p>示例：</p>
<pre><code><span class="comment">// one module</span>
define(<span class="string">'html/utils'</span>,
    <span class="comment">/**
     * Utility functions to ease working with DOM elements.
     * <span class="doctag">@exports</span> html/utils
     */</span>
    <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
        <span class="keyword">var</span> exports = {
        };

        <span class="keyword">return</span> exports;
    }
);

<span class="comment">// another module</span>
define(<span class="string">'tag'</span>,
    <span class="comment">/** <span class="doctag">@exports</span> tag */</span>
    <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
        <span class="keyword">var</span> exports = {
        };

        <span class="keyword">return</span> exports;
    }
);
</code></pre><p>[建议] 对于 exports 为 Object 的模块，可以使用<code>@namespace</code>标识。</p>
<p>解释：</p>
<p>使用 @namespace 而不是 @module 或 @exports 时，对模块的引用可以省略 module: 前缀。</p>
<p>[建议] 对于 exports 为类名的模块，使用 <code>@class</code> 和 <code>@exports</code> 标识。</p>
<p>示例：</p>
<pre><code>// 只使用 <span class="comment">@class Bar 时，类方法和属性都必须增加 @name Bar#methodName 来标识，与 @exports 配合可以免除这一麻烦，并且在引用时可以省去 module: 前缀。</span>
// 另外需要注意类名需要使用 var 定义的方式。

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> Bar description
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@see foo</span>
 <span class="keyword">*</span> <span class="comment">@exports  Bar</span>
 <span class="keyword">*</span> <span class="comment">@class</span>
 <span class="keyword">*</span>/
var Bar = function () {
    // TODO
};

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> baz description
 <span class="keyword">*</span>
 <span class="keyword">*</span> <span class="comment">@return {(string|Array)} return description</span>
 <span class="keyword">*</span>/
Bar.prototype.baz = function () {
    // TODO
};
</code></pre><h4 id="细节注释">细节注释</h4><p>对于内部实现、不容易理解的逻辑说明、摘要信息等，我们可能需要编写细节注释。</p>
<p><strong>[建议] 细节注释遵循单行注释的格式。说明必须换行时，每行是一个单行注释的起始。</strong></p>
<p>示例：</p>
<pre><code><span class="tag">function</span> <span class="tag">foo</span>(p1, p2) {
    <span class="comment">// 这里对具体内部逻辑进行说明</span>
    <span class="comment">// 说明太长需要换行</span>
    <span class="tag">for</span> (...) {
        ....
    }
}
</code></pre><p><strong>[强制] 有时我们会使用一些特殊标记进行说明。特殊标记必须使用单行注释的形式。下面列举了一些常用标记：</strong></p>
<p>解释：</p>
<p>TODO: 有功能待实现。此时需要对将要实现的功能进行简单说明。</p>
<p>FIXME: 该处代码运行没问题，但可能由于时间赶或者其他原因，需要修正。此时需要对如何修正进行简单说明。</p>
<p>HACK: 为修正某些问题而写的不太好或者使用了某些诡异手段的代码。此时需要对思路或诡异手段进行描述。</p>
<p>XXX: 该处存在陷阱。此时需要对陷阱进行描述。</p>
<h2 id="语言特性">语言特性</h2><h3 id="变量">变量</h3><p><strong>[强制] 变量在使用前必须通过 <code>var</code> 定义。</strong></p>
<p>解释：</p>
<p>不通过 var 定义变量将导致变量污染全局环境。</p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'MyName'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line">name = <span class="string">'MyName'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 每个 <code>var</code> 只能声明一个变量。</strong></p>
<p>解释：</p>
<p>一个 var 声明多个变量，容易导致较长的行长度，并且在修改时容易造成逗号和分号的混淆。</p>
<p>示例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> hangModules</span> = [];</span><br><span class="line"><span class="variable"><span class="keyword">var</span> missModules</span> = [];</span><br><span class="line"><span class="variable"><span class="keyword">var</span> visited</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> hangModules</span> = [],</span><br><span class="line">    missModules = [],</span><br><span class="line">    visited = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 变量必须 <em>即用即声明</em>，不得在函数或其它形式的代码块起始位置统一声明所有变量。</strong></p>
<p>解释：</p>
<p>变量声明与使用的距离越远，出现的跨度越大，代码的阅读与维护成本越高。虽然JavaScript的变量是函数作用域，还是应该根据编程中的意图，缩小变量出现的距离空间。</p>
<p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">kv2List</span><span class="params">(source)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">list</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key in source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (source.hasOwnProperty(key)) &#123;</span><br><span class="line">            <span class="keyword">var</span> item = &#123;</span><br><span class="line">                k: key,</span><br><span class="line">                v: source[key]</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">list</span>.push(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">list</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">kv2List</span><span class="params">(source)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">list</span> = [];</span><br><span class="line">    <span class="keyword">var</span> key;</span><br><span class="line">    <span class="keyword">var</span> item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (key in source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (source.hasOwnProperty(key)) &#123;</span><br><span class="line">            item = &#123;</span><br><span class="line">                k: key,</span><br><span class="line">                v: source[key]</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">list</span>.push(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">list</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="条件">条件</h3><p><strong>[强制] 在 Equality Expression 中使用类型严格的 <code>===</code>。仅当判断 <code>null</code> 或 <code>undefined</code> 时，允许使用 <code>== null</code>。</strong></p>
<p>解释：</p>
<p>使用 <code>===</code> 可以避免等于判断中隐式的类型转换。</p>
<p>示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">if</span> (age === <span class="number">30</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (age == <span class="number">30</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 尽可能使用简洁的表达式。</strong></p>
<p>示例：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="tag">if</span> (!name) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="tag">if</span> (name === <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 字符串非空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="tag">if</span> (name) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="tag">if</span> (name !== <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 数组非空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="tag">if</span> (collection.length) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="tag">if</span> (collection.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 布尔不成立</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="tag">if</span> (!notTrue) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="tag">if</span> (notTrue === false) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// null 或 undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="tag">if</span> (noValue == null) &#123;</span><br><span class="line">  <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="tag">if</span> (noValue === null || typeof noValue === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 按执行频率排列分支的顺序。</strong></p>
<p>解释：</p>
<p>按执行频率排列分支的顺序好处是：</p>
<p>阅读的人容易找到最常见的情况，增加可读性。<br>提高执行效率。</p>
<p><strong>[建议] 对于相同变量或表达式的多值条件，用 switch 代替 if。</strong></p>
<p>示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="keyword">typeof</span> variable) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'object'</span>:</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'number'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'boolean'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'string'</span>:</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">type</span> = <span class="keyword">typeof</span> variable;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">'number'</span> || <span class="keyword">type</span> === <span class="string">'boolean'</span> || <span class="keyword">type</span> === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 如果函数或全局中的 else 块后没有任何语句，可以删除 else。</strong></p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'unnamed'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'unnamed'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="循环">循环</h3><p><strong>[建议] 不要在循环体中包含函数表达式，事先将函数提取到循环体外。</strong></p>
<p>解释：</p>
<p>循环体中的函数表达式，运行过程中会生成循环次数个函数对象。</p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clicker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = elements.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[i];</span><br><span class="line">    addListener(element, <span class="string">'click'</span>, clicker);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = elements.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[i];</span><br><span class="line">    addListener(element, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 对循环内多次使用的不变值，在循环外用变量缓存。</strong></p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> width = wrap.offsetWidth + <span class="string">'px'</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, <span class="built_in">len</span> = elements.length; i &lt; <span class="built_in">len</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[i];</span><br><span class="line">    element.style.width = width;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, <span class="built_in">len</span> = elements.length; i &lt; <span class="built_in">len</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[i];</span><br><span class="line">    element.style.width = wrap.offsetWidth + <span class="string">'px'</span>;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 对有序集合进行遍历时，缓存 <code>length</code>。</strong></p>
<p>解释：</p>
<p>虽然现代浏览器都对数组长度进行了缓存，但对于一些宿主对象和老旧浏览器的数组对象，在每次 length 访问时会动态计算元素个数，此时缓存 length 能有效提高程序性能。</p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, <span class="built_in">len</span> = elements.length; i &lt; <span class="built_in">len</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[i];</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 对有序集合进行顺序无关的遍历时，使用逆序遍历。</strong></p>
<p>解释：</p>
<p>逆序遍历可以节省变量，代码比较优化。</p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">len</span> = elements.length;</span><br><span class="line">while (<span class="built_in">len</span>--) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = elements[<span class="built_in">len</span>];</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型">类型</h3><h4 id="类型检测">类型检测</h4><p><strong>[建议] 类型检测优先使用 <code>typeof</code>。对象类型检测使用 <code>instanceof</code>。<code>null</code> 或 <code>undefined</code> 的检测使用 == <code>null</code>。</strong></p>
<p>示例：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'string'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// number</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'number'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// boolean</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'boolean'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'function'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'object'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RegExp</span></span><br><span class="line"><span class="built_in">variable</span> instanceof RegExp</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="built_in">variable</span> instanceof <span class="built_in">Array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// null</span></span><br><span class="line"><span class="built_in">variable</span> === <span class="built_in">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// null or undefined</span></span><br><span class="line"><span class="built_in">variable</span> == <span class="built_in">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line">typeof <span class="built_in">variable</span> === <span class="string">'undefined'</span></span><br></pre></td></tr></table></figure>
<h4 id="类型转换">类型转换</h4><p><strong>[建议] 转换成 <code>string</code> 时，使用 <code>+ &#39;&#39;</code>。</strong></p>
<p>示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="built_in">num</span> + <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">String</span>(<span class="built_in">num</span>);</span><br><span class="line"><span class="built_in">num</span>.toString();</span><br><span class="line"><span class="built_in">String</span>(<span class="built_in">num</span>);</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 转换成 <code>number</code> 时，通常使用 <code>+</code>。</strong></p>
<p>示例：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line">+<span class="keyword">str</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line">Number(<span class="keyword">str</span>);</span><br></pre></td></tr></table></figure>
<p><strong>[建议] <code>string</code> 转换成 <code>number</code>，要转换的字符串结尾包含非数字并期望忽略时，使用 parseInt。</strong></p>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> width = <span class="string">'200px'</span>;</span><br><span class="line"><span class="built_in">parseInt</span>(width, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 使用 <code>parseInt</code> 时，必须指定进制。</strong></p>
<p>示例：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line">parseInt(<span class="keyword">str</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line">parseInt(<span class="keyword">str</span>);</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 转换成 <code>boolean</code> 时，使用 <code>!!</code>。</strong></p>
<p>示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">3.14</span>;</span><br><span class="line">!!<span class="built_in">num</span>;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] <code>number</code> 去除小数点，使用 <code>Math.floor / Math.round / Math.ceil</code>，不使用 <code>parseInt</code>。</strong></p>
<p>示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">3.14</span>;</span><br><span class="line">Math.ceil(<span class="built_in">num</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">3.14</span>;</span><br><span class="line">parseInt(<span class="built_in">num</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h3 id="字符串">字符串</h3><p><strong>[强制] 字符串开头和结束使用单引号 <code>&#39;</code>。</strong></p>
<p>解释：</p>
<p>输入单引号不需要按住 shift，方便输入。<br>实际使用中，字符串经常用来拼接 HTML。为方便 HTML 中包含双引号而不需要转义写法。<br>示例：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = '我是一个字符串';</span><br><span class="line"><span class="keyword">var</span> html = '&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"cls"</span>&gt;拼接<span class="type">HTML</span>可以省去双引号转义&lt;/div&gt;';</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 使用 <code>数组</code> 或 <code>+</code> 拼接字符串。</strong></p>
<p>解释：</p>
<p>使用 + 拼接字符串，如果拼接的全部是 StringLiteral，压缩工具可以对其进行自动合并的优化。所以，静态字符串建议使用 + 拼接。<br>在现代浏览器下，使用 + 拼接字符串，性能较数组的方式要高。<br>如需要兼顾老旧浏览器，应尽量使用数组拼接字符串。<br>示例：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用数组拼接字符串</span></span><br><span class="line"><span class="keyword">var</span> str = [</span><br><span class="line">    <span class="comment">// 推荐换行开始并缩进开始第一个字符串, 对齐代码, 方便阅读.</span></span><br><span class="line">    <span class="string">'&lt;ul&gt;'</span>,</span><br><span class="line">        <span class="string">'&lt;li&gt;第一项&lt;/li&gt;'</span>,</span><br><span class="line">        <span class="string">'&lt;li&gt;第二项&lt;/li&gt;'</span>,</span><br><span class="line">    <span class="string">'&lt;/ul&gt;'</span></span><br><span class="line">].<span class="keyword">join</span>(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 + 拼接字符串</span></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="string">''</span> <span class="comment">// 建议第一个为空字符串, 第二个换行开始并缩进开始, 对齐代码, 方便阅读</span></span><br><span class="line">    + <span class="string">'&lt;ul&gt;'</span>,</span><br><span class="line">    +    <span class="string">'&lt;li&gt;第一项&lt;/li&gt;'</span>,</span><br><span class="line">    +    <span class="string">'&lt;li&gt;第二项&lt;/li&gt;'</span>,</span><br><span class="line">    + <span class="string">'&lt;/ul&gt;'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 复杂的数据到视图字符串的转换过程，选用一种模板引擎。</strong></p>
<p>解释：</p>
<p>使用模板引擎有如下好处：</p>
<p>在开发过程中专注于数据，将视图生成的过程由另外一个层级维护，使程序逻辑结构更清晰。<br>优秀的模板引擎，通过模板编译技术和高质量的编译产物，能获得比手工拼接字符串更高的性能。</p>
<p>artTemplate: 体积较小，在所有环境下性能高，语法灵活。</p>
<p>dot.js: 体积小，在现代浏览器下性能高，语法灵活。</p>
<p>etpl: 体积较小，在所有环境下性能高，模板复用性高，语法灵活。</p>
<p>handlebars: 体积大，在所有环境下性能高，扩展性高。</p>
<p>hogon: 体积小，在现代浏览器下性能高。</p>
<p>nunjucks: 体积较大，性能一般，模板复用性高。</p>
<h3 id="对象">对象</h3><p><strong>[强制] 使用对象字面量 <code>{}</code> 创建新 <code>Object</code>。</strong></p>
<p>示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 对象创建时，如果一个对象的所有 <code>属性</code> 均可以不添加引号，则所有 <code>属性</code> 不得添加引号。</strong></p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">    name: <span class="string">'someone'</span>,</span><br><span class="line">    age: <span class="number">28</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 对象创建时，如果任何一个 <code>属性</code> 需要添加引号，则所有 <code>属性</code> 必须添加 <code>&#39;</code>。</strong></p>
<p>解释：</p>
<p>如果属性不符合 Identifier 和 NumberLiteral 的形式，就需要以 StringLiteral 的形式提供。</p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'someone'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">28</span>,</span><br><span class="line">    <span class="string">'more-info'</span>: <span class="string">'...'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">    name: <span class="string">'someone'</span>,</span><br><span class="line">    age: <span class="number">28</span>,</span><br><span class="line">    <span class="string">'more-info'</span>: <span class="string">'...'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 不允许修改和扩展任何原生对象和宿主对象的原型。</strong></p>
<p>示例：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下行为绝对禁止</span></span><br><span class="line"><span class="keyword">String</span>.prototype.trim = <span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="comment">&#123;</span><br><span class="line">&#125;</span>;</span></span><br></pre></td></tr></table></figure>
<p><strong>[建议] 属性访问时，尽量使用 <code>.</code>。</strong></p>
<p>解释：</p>
<p>属性名符合 Identifier 的要求，就可以通过 . 来访问，否则就只能通过 <code>[expr]</code> 方式访问。</p>
<p>通常在 JavaScript 中声明的对象，属性命名是使用 Camel 命名法，用 . 来访问更清晰简洁。部分特殊的属性(比如来自后端的JSON)，可能采用不寻常的命名方式，可以通过 <code>[expr]</code> 方式访问。</p>
<p>示例：</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">info</span>.age;</span><br><span class="line"><span class="keyword">info</span>[<span class="string">'more-info'</span>];</span><br></pre></td></tr></table></figure>
<p><strong>[建议] <code>for in</code> 遍历对象时, 使用 <code>hasOwnProperty</code> 过滤掉原型中的属性。</strong></p>
<p>示例：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var newInfo = &#123;&#125;;</span><br><span class="line"><span class="keyword">for</span> (var <span class="variable">key</span> in info) &#123;</span><br><span class="line">    <span class="keyword">if</span> (info.hasOwnProperty(<span class="variable">key</span>)) &#123;</span><br><span class="line">        newInfo[<span class="variable">key</span>] = info[<span class="variable">key</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数组">数组</h3><p><strong>[强制] 使用数组字面量 <code>[]</code> 创建新数组，除非想要创建的是指定长度的数组。</strong></p>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 遍历数组不使用 <code>for in</code>。</strong></p>
<p>解释：</p>
<p>数组对象可能存在数字以外的属性, 这种情况下 for in 不会得到正确结果。</p>
<p>示例：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line">arr.other = <span class="string">'other things'</span>; <span class="comment">// 这里仅作演示, 实际中应使用Object类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的遍历方式</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) <span class="comment">&#123;</span><br><span class="line">    console.log(i);</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的遍历方式</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> arr) <span class="comment">&#123;</span><br><span class="line">    console.log(i);</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>[建议] 不因为性能的原因自己实现数组排序功能，尽量使用数组的 <code>sort</code> 方法。</strong></p>
<p>解释：</p>
<p>自己实现的常规排序算法，在性能上并不优于数组默认的 sort 方法。以下两种场景可以自己实现排序：</p>
<p>需要稳定的排序算法，达到严格一致的排序结果。<br>数据特点鲜明，适合使用桶排。<br><strong>[建议] 清空数组使用 <code>.length = 0</code>。</strong></p>
<h3 id="函数">函数</h3><h4 id="函数长度">函数长度</h4><p><strong>[建议] 一个函数的长度控制在 <code>50</code> 行以内。</strong></p>
<p>解释：</p>
<p>将过多的逻辑单元混在一个大函数中，易导致难以维护。一个清晰易懂的函数应该完成单一的逻辑单元。复杂的操作应进一步抽取，通过函数的调用来体现流程。</p>
<p>特定算法等不可分割的逻辑允许例外。</p>
<p>示例：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">syncViewStateOnUserAction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.<span class="keyword">checked</span>) &#123;</span><br><span class="line">        y.<span class="keyword">checked</span> = <span class="keyword">true</span>;</span><br><span class="line">        z.<span class="keyword">value</span> = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        y.<span class="keyword">checked</span> = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!a.<span class="keyword">value</span>) &#123;</span><br><span class="line">        warning.innerText = <span class="string">'Please enter it'</span>;</span><br><span class="line">        submitButton.disabled = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        warning.innerText = <span class="string">''</span>;</span><br><span class="line">        submitButton.disabled = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接阅读该函数会难以明确其主线逻辑，因此下方是一种更合理的表达方式：</span></span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">syncViewStateOnUserAction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    syncXStateToView();</span><br><span class="line">    checkAAvailability();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">syncXStateToView</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.<span class="keyword">checked</span>) &#123;</span><br><span class="line">        y.<span class="keyword">checked</span> = <span class="keyword">true</span>;</span><br><span class="line">        z.<span class="keyword">value</span> = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        y.<span class="keyword">checked</span> = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">checkAAvailability</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!a.<span class="keyword">value</span>) &#123;</span><br><span class="line">        displayWarningForAMissing();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        clearWarnignForA();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数设计">参数设计</h4><p><strong>[建议] 一个函数的参数控制在 6 个以内。</strong></p>
<p>解释：</p>
<p>除去不定长参数以外，函数具备不同逻辑意义的参数建议控制在 6 个以内，过多参数会导致维护难度增大。</p>
<p>某些情况下，如使用 AMD Loader 的 require 加载多个模块时，其 callback 可能会存在较多参数，因此对函数参数的个数不做强制限制。</p>
<p><strong>[建议] 通过 <code>options</code> 参数传递非数据输入型参数。</strong></p>
<p>解释：</p>
<p>有些函数的参数并不是作为算法的输入，而是对算法的某些分支条件判断之用，此类参数建议通过一个 options 参数传递。</p>
<p>如下函数：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> 移除某个元素</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param &#123;Node&#125; element 需要移除的元素</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param &#123;boolean&#125; removeEventListeners 是否同时将所有注册在元素上的事件移除</span></span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">function removeElement(element, removeEventListeners) &#123;</span><br><span class="line">    element.parent.removeChild(element);</span><br><span class="line">    if (removeEventListeners) &#123;</span><br><span class="line">        element.clearEventListeners();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以转换为下面的签名：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> 移除某个元素</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param &#123;Node&#125; element 需要移除的元素</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param &#123;Object&#125; options 相关的逻辑配置</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param &#123;boolean&#125; options.removeEventListeners 是否同时将所有注册在元素上的事件移除</span></span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">function removeElement(element, options) &#123;</span><br><span class="line">    element.parent.removeChild(element);</span><br><span class="line">    if (options.removeEventListeners) &#123;</span><br><span class="line">        element.clearEventListeners();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种模式有几个显著的优势：</p>
<ul>
<li>boolean 型的配置项具备名称，从调用的代码上更易理解其表达的逻辑意义。</li>
<li>当配置项有增长时，无需无休止地增加参数个数，不会出现 removeElement(element, true, false, false, 3) 这样难以理解的调用代码。</li>
<li>当部分配置参数可选时，多个参数的形式非常难处理重载逻辑，而使用一个 options 对象只需判断属性是否存在，实现得以简化。</li>
</ul>
<h4 id="闭包">闭包</h4><p><strong>[建议] 在适当的时候将闭包内大对象置为 <code>null</code>。</strong></p>
<p>解释：</p>
<p>在 JavaScript 中，无需特别的关键词就可以使用闭包，一个函数可以任意访问在其定义的作用域外的变量。需要注意的是，函数的作用域是静态的，即在定义时决定，与调用的时机和方式没有任何关系。</p>
<p>闭包会阻止一些变量的垃圾回收，对于较老旧的JavaScript引擎，可能导致外部所有变量均无法回收。</p>
<p>首先一个较为明确的结论是，以下内容会影响到闭包内变量的回收：</p>
<ul>
<li>嵌套的函数中是否有使用该变量。</li>
<li>嵌套的函数中是否有 直接调用eval。</li>
<li>是否使用了 with 表达式。<br>Chakra、V8 和 SpiderMonkey 将受以上因素的影响，表现出不尽相同又较为相似的回收策略，而JScript.dll和Carakan则完全没有这方面的优化，会完整保留整个 LexicalEnvironment 中的所有变量绑定，造成一定的内存消耗。</li>
</ul>
<p>由于对闭包内变量有回收优化策略的 Chakra、V8 和 SpiderMonkey 引擎的行为较为相似，因此可以总结如下，当返回一个函数 fn 时：</p>
<ol>
<li>如果 fn 的 [[Scope]] 是ObjectEnvironment（with 表达式生成 ObjectEnvironment，函数和 catch 表达式生成 DeclarativeEnvironment），则：<br> i. 如果是 V8 引擎，则退出全过程。<br> i. 如果是 SpiderMonkey，则处理该 ObjectEnvironment 的外层 LexicalEnvironment。</li>
<li>获取当前 LexicalEnvironment 下的所有类型为 Function 的对象，对于每一个 Function 对象，分析其 FunctionBody：<br> i. 如果 FunctionBody 中含有 直接调用eval，则退出全过程。<br> i. 否则得到所有的 Identifier。<br> i. 对于每一个 Identifier，设其为 name，根据查找变量引用的规则，从 LexicalEnvironment 中找出名称为 name 的绑定 binding。<br> i. 对 binding 添加 notSwap 属性，其值为 true。</li>
<li>检查当前 LexicalEnvironment 中的每一个变量绑定，如果该绑定有 notSwap 属性且值为 true，则：<br> i. 如果是V8引擎，删除该绑定。<br> i. 如果是SpiderMonkey，将该绑定的值设为 undefined，将删除 notSwap 属性。<br>对于Chakra引擎，暂无法得知是按 V8 的模式还是按 SpiderMonkey 的模式进行。</li>
</ol>
<p>如果有 非常庞大 的对象，且预计会在 老旧的引擎 中执行，则使用闭包时，注意将闭包不需要的对象置为空引用。</p>
<p><strong>[建议] 使用 <code>IIFE</code> 避免 <code>Lift</code> 效应。</strong></p>
<p>解释：</p>
<p>在引用函数外部变量时，函数执行时外部变量的值由运行时决定而非定义时，最典型的场景如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tasks = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    tasks[tasks.length] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Current cursor is at '</span> + i);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> len = tasks.length;</span><br><span class="line"><span class="keyword">while</span> (len--) &#123;</span><br><span class="line">    tasks[len]();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码对 tasks 中的函数的执行均会输出 <code>Current cursor is at 5</code>，往往不符合预期。</p>
<p>此现象称为 <strong>Lift</strong> 效应 。解决的方式是通过额外加上一层闭包函数，将需要的外部变量作为参数传递来解除变量的绑定关系：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tasks = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 注意有一层额外的闭包</span></span><br><span class="line">    tasks[tasks.length] = (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Current cursor is at '</span> + i);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> len = tasks.length;</span><br><span class="line"><span class="keyword">while</span> (len--) &#123;</span><br><span class="line">    tasks[len]();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="空函数">空函数</h4><p><strong>[建议] 空函数不使用 new Function() 的形式。</strong></p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emptyFunction = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 对于性能有高要求的场合，建议存在一个空函数的常量，供多处使用共享。</strong></p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EMPTY_FUNCTION = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyClass.prototype.abstractMethod = EMPTY_FUNCTION;</span><br><span class="line">MyClass.prototype.hooks.before = EMPTY_FUNCTION;</span><br><span class="line">MyClass.prototype.hooks.after = EMPTY_FUNCTION;</span><br></pre></td></tr></table></figure>
<h3 id="面向对象">面向对象</h3><p><strong>[强制] 类的继承方案，实现时需要修正 <code>constructor</code>。</strong></p>
<p>解释：</p>
<p>通常使用其他 library 的类继承方案都会进行 constructor 修正。如果是自己实现的类继承方案，需要进行 constructor 修正。</p>
<p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 构建类之间的继承关系</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@param</span> &#123;Function&#125; subClass 子类函数</span><br><span class="line"> * <span class="doctag">@param</span> &#123;Function&#125; superClass 父类函数</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherits</span><span class="params">(subClass, superClass)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> F = <span class="keyword">new</span> <span class="function"><span class="keyword">Function</span><span class="params">()</span></span>;</span><br><span class="line">    F.prototype = superClass.prototype;</span><br><span class="line">    subClass.prototype = <span class="keyword">new</span> F();</span><br><span class="line">    subClass.prototype.constructor = subClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 声明类时，保证 <code>constructor</code> 的正确性。</strong></p>
<p>示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接prototype等于对象时，需要修正constructor</span></span><br><span class="line">Animal.prototype = &#123;</span><br><span class="line">    <span class="constructor"><span class="keyword">constructor</span>: Animal,</span><br><span class="line"></span><br><span class="line">    jump: function () </span>&#123;</span><br><span class="line">        alert(<span class="string">'animal '</span> + <span class="keyword">this</span>.name + <span class="string">' jump'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这种方式扩展prototype则无需理会constructor</span></span><br><span class="line">Animal.prototype.jump = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'animal '</span> + <span class="keyword">this</span>.name + <span class="string">' jump'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[建议] 属性在构造函数中声明，方法在原型中声明。</strong></p>
<p>解释：</p>
<p>原型对象的成员被所有实例共享，能节约内存占用。所以编码时我们应该遵守这样的原则：原型对象包含程序不会修改的成员，如方法函数或配置项。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TextNode</span><span class="params">(value, engine)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">    <span class="keyword">this</span>.engine = engine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TextNode.prototype.clone = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>[强制] 自定义事件的 <code>事件名</code> 必须全小写。</strong></p>
<p>解释：</p>
<p>在 JavaScript 广泛应用的浏览器环境，绝大多数 DOM 事件名称都是全小写的。为了遵循大多数 JavaScript 开发者的习惯，在设计自定义事件时，事件名也应该全小写。</p>
<p><strong>[强制] 自定义事件只能有一个 event 参数。如果事件需要传递较多信息，应仔细设计事件对象。</strong></p>
<p>解释：</p>
<p>一个事件对象的好处有：</p>
<p>顺序无关，避免事件监听者需要记忆参数顺序。<br>每个事件信息都可以根据需要提供或者不提供，更自由。<br>扩展方便，未来添加事件信息时，无需考虑会破坏监听器参数形式而无法向后兼容。<br><strong>[建议] 设计自定义事件时，应考虑禁止默认行为。</strong></p>
<p>解释：</p>
<p>常见禁止默认行为的方式有两种：</p>
<p>事件监听函数中 return false。<br>事件对象中包含禁止默认行为的方法，如 preventDefault。</p>
<h3 id="动态特性">动态特性</h3><h4 id="eval">eval</h4><p><strong>[强制] 避免使用直接 <code>eval</code> 函数。</strong></p>
<p>解释：</p>
<p>直接 eval，指的是以函数方式调用 eval 的调用方法。直接 eval 调用执行代码的作用域为本地作用域，应当避免。</p>
<p>如果有特殊情况需要使用直接 eval，需在代码中用详细的注释说明为何必须使用直接 eval，不能使用其它动态执行代码的方式，同时需要其他资深工程师进行 Code Review。</p>
<p><strong>[建议] 尽量避免使用 <code>eval</code> 函数。</strong></p>
<h4 id="动态执行代码">动态执行代码</h4><p><strong>[建议] 使用 <code>new Function</code> 执行动态代码。</strong></p>
<p>解释：</p>
<p>通过 new Function 生成的函数作用域是全局使用域，不会影响当当前的本地作用域。如果有动态代码执行的需求，建议使用 new Function。</p>
<p>示例：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = new <span class="type">Function</span>('x', 'y', '<span class="keyword">return</span> x + y;');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = handler($('<span class="comment">#x').val(), $('#y').val());</span></span><br></pre></td></tr></table></figure>
<h4 id="with">with</h4><p><strong>[建议] 尽量不要使用 <code>with</code>。</strong></p>
<p>解释：</p>
<p>使用 with 可能会增加代码的复杂度，不利于阅读和管理；也会对性能有影响。大多数使用 with 的场景都能使用其他方式较好的替代。所以，尽量不要使用 with。</p>
<h4 id="delete">delete</h4><p>[建议] 减少 <code>delete</code> 的使用。</p>
<p>解释：</p>
<p>如果没有特别的需求，减少或避免使用<code>delete</code>。<code>delete</code>的使用会破坏部分 JavaScript 引擎的性能优化。</p>
<p>[建议] 处理 <code>delete</code> 可能产生的异常。</p>
<p>解释：</p>
<p>对于有被遍历需求，且值 null 被认为具有业务逻辑意义的值的对象，移除某个属性必须使用 delete 操作。</p>
<p>在严格模式或IE下使用 delete 时，不能被删除的属性会抛出异常，因此在不确定属性是否可以删除的情况下，建议添加 try-catch 块。</p>
<p>示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">delete</span> o.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (deleteError) &#123;</span><br><span class="line">    o.x = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对象属性">对象属性</h4><p><strong>[建议] 避免修改外部传入的对象。</strong></p>
<p>解释：</p>
<p>JavaScript 因其脚本语言的动态特性，当一个对象未被 seal 或 freeze 时，可以任意添加、删除、修改属性值。</p>
<p>但是随意地对 非自身控制的对象 进行修改，很容易造成代码在不可预知的情况下出现问题。因此，设计良好的组件、函数应该避免对外部传入的对象的修改。</p>
<p>下面代码的 selectNode 方法修改了由外部传入的 datasource 对象。如果 datasource 用在其它场合（如另一个 Tree 实例）下，会造成状态的混乱。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tree</span><span class="params">(datasource)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.datasource = datasource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tree.prototype.selectNode = <span class="function"><span class="keyword">function</span> <span class="params">(id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 从datasource中找出节点对象</span></span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">this</span>.findNode(id);</span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">        node.selected = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.flushView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对于此类场景，需要使用额外的对象来维护，使用由自身控制，不与外部产生任何交互的 selectedNodeIndex 对象来维护节点的选中状态，不对 datasource 作任何修改。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tree</span><span class="params">(datasource)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.datasource = datasource;</span><br><span class="line">    <span class="keyword">this</span>.selectedNodeIndex = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tree.prototype.selectNode = <span class="function"><span class="keyword">function</span> <span class="params">(id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 从datasource中找出节点对象</span></span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">this</span>.findNode(id);</span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">        <span class="keyword">this</span>.selectedNodeIndex[id] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.flushView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>除此之外，也可以通过 deepClone 等手段将自身维护的对象与外部传入的分离，保证不会相互影响。</p>
<p><strong>[建议] 具备强类型的设计。</strong></p>
<p>解释：</p>
<ul>
<li>如果一个属性被设计为 boolean 类型，则不要使用 1 / 0 作为其值。对于标识性的属性，如对代码体积有严格要求，可以从一开始就设计为 number 类型且将 0 作为否定值。</li>
<li>从 DOM 中取出的值通常为 string 类型，如果有对象或函数的接收类型为 number 类型，提前作好转换，而不是期望对象、函数可以处理多类型的值。</li>
</ul>
<h2 id="前后端分离思考">前后端分离思考</h2><p>前后端分离的开发模式对于我们的AngularJS + jerseyRESTful的技术选型上来说是能能提高开发效率的方法。目前却发现前后端还是耦合程度太大，前端并不能mock自己的数据。还是需要等后台的接口，前端开发我做出了如下的思考：</p>
<ul>
<li><p><strong>Module 和 resource之间做一层封装：</strong></p>
<p>  用来对resource的JSON数据对接，这样不会导致Controler里面的数据会和resource的JSON数据耦合。</p>
</li>
<li><p><strong>测试：</strong></p>
<p>  nodeJS的强大支持在于给前端提供了一套生态系统，能够自动化构建前端项目。测试方面有Karma神器，可以在下一版中加入应用。</p>
</li>
<li><p><strong>接口:</strong></p>
<p>  希望接口开发的时候实时更新文档，包括参数、返回值、异常。</p>
</li>
<li><p><strong>异常处理：</strong></p>
<p>  后台的接口设计需要思考，RESTful接口是对资源在表现层状态转化。所以一个接口应该抽象出来对应一个资源的操作，异常的生成到最后转换到对用户的通知需要仔细思考。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>重要方法</th>
<th>典型用法</th>
<th>典型状态码</th>
<th>安全？</th>
<th>幂等 </th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>-获取表示<br>- 变更时获取表示(缓存)</td>
<td>200（OK）-表示已在响应中发出<br>204（无内容） - 资源有空表示<br>301（Moved Permanently） - 资源的URI已被更新<br>303（See Other） - 其他（如，负载均衡）<br>304（not modified）- 资源未更改（缓存）<br>400 （bad request）- 指代坏请求（如，参数错误）<br>404 （not found）- 资源不存在<br>406 （not acceptable）- 服务端不支持所需表示<br>500 （internal server error）- 通用错误响应<br>503 （Service Unavailable）- 服务端当前无法处理请求</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>DELETE</td>
<td>- 删除资源</td>
<td>200（OK）-资源已被删除<br>301（Moved Permanently） - 资源的URI已更改<br>303（See Other） - 其他（如，负载均衡）<br>400 （bad request）- 指代坏请求（如，参数错误）<br>404 （not found）- 资源不存在<br>409 （not acceptable）- 通用冲突<br>500 （internal server error）- 通用错误响应<br>503 （Service Unavailable）- 服务端当前无法处理请求</td>
<td>否</td>
<td>是 </td>
</tr>
<tr>
<td>PUT</td>
<td>- 用客户端管理的实例号创建一个资源<br> - 通过替换方式更新资源<br> - 如果未被修改，则更新资源（乐观锁）</td>
<td>200（OK）-表示已在响应中发出<br>201 （created） - 如果新资源被创建<br>301（Moved Permanently） - 资源的URI已被更新<br>303（See Other） - 其他（如，负载均衡）<br>400 （bad request）- 指代坏请求（如，参数错误）<br>404 （not found）- 资源不存在<br>406 （not acceptable）- 服务端不支持所需表示<br> 409 (conflict) - 通用冲突<br>412 (Precondition Failed) - 前置条件失败（如执行条件更新时冲突）<br>415 （unsupported media type） - 接受到得表示不受支持<br>500 （internal server error）- 通用错误响应<br>503 （Service Unavailable）- 服务端当前无法处理请求</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>POST</td>
<td>-使用服务端管理的（自动产生）的实例号创建资源<br> - 创建子资源<br> - 部分更新资源<br> - 如果没有被修改，则不过更新资源（乐观锁）</td>
<td>200（OK）- 如果现有资源已被更改<br>201（created）- 如果新资源被创建<br>202（accepted）- 已接受处理请求但尚未完成（异步处理）<br>301（Moved Permanently）- 资源的URI被更新<br>303（See Other）- 其他（如，负载均衡）<br>400（bad request）- 指代坏请求<br>404 （not found）- 资源不存在<br>406 （not acceptable）- 服务端不支持所需表示<br>409 （conflict）- 通用冲突<br>412 （Precondition Failed）- 前置条件失败（如执行条件更新时的冲突）<br>415 （unsupported media type）- 接受到的表示不受支持<br>500 （internal server error）- 通用错误响应<br>503 （Service Unavailable）- 服务当前无法处理请求</td>
<td>否</td>
<td>否</td>
</tr>
</tbody>
</table>
<h2 id="细节实现">细节实现</h2><ul>
<li><p><strong>第三方登陆优化</strong></p>
<p>  第三方的API利用不够充分，应该能做更多事。</p>
</li>
<li><p><strong>交互动画</strong></p>
<p>  介于对手机OS及硬件的复杂性这个版本没有应用HTML5及CSS3的强大动画机制，如果下个版本时间、人手充裕可以加入更加棒的UX。适配的话考虑对User-Agent的匹配吧。</p>
</li>
</ul>
<h2 id="参考文献">参考文献</h2><ul>
<li>Baidu EFE team <a href="https://github.com/ecomfe/spec/blob/master/javascript-style-guide.md" target="_blank" rel="external">Javascript编码规范</a></li>
</ul>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Angular/" rel="tag">#Angular</a>
          
            <a href="/tags/代码规范/" rel="tag">#代码规范</a>
          
            <a href="/tags/总结/" rel="tag">#总结</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/11/05/Node-js开发调试/" rel="next" title="Node.js开发调试技巧">
                <i class="fa fa-chevron-left"></i> Node.js开发调试技巧
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Levy Li" />
          <p class="site-author-name" itemprop="name">Levy Li</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码风格"><span class="nav-number">2.</span> <span class="nav-text">代码风格</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#文件"><span class="nav-number">2.1.</span> <span class="nav-text">文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名"><span class="nav-number">2.2.</span> <span class="nav-text">命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注释"><span class="nav-number">2.3.</span> <span class="nav-text">注释</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单行注释"><span class="nav-number">2.3.1.</span> <span class="nav-text">单行注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多行注释"><span class="nav-number">2.3.2.</span> <span class="nav-text">多行注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文档化注释"><span class="nav-number">2.3.3.</span> <span class="nav-text">文档化注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类型定义"><span class="nav-number">2.3.4.</span> <span class="nav-text">类型定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件注释"><span class="nav-number">2.3.5.</span> <span class="nav-text">文件注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命名空间注释"><span class="nav-number">2.3.6.</span> <span class="nav-text">命名空间注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类注释"><span class="nav-number">2.3.7.</span> <span class="nav-text">类注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数/方法注释"><span class="nav-number">2.3.8.</span> <span class="nav-text">函数/方法注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事件注释"><span class="nav-number">2.3.9.</span> <span class="nav-text">事件注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#常量注释"><span class="nav-number">2.3.10.</span> <span class="nav-text">常量注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复杂类型注释"><span class="nav-number">2.3.11.</span> <span class="nav-text">复杂类型注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AMD_模块注释"><span class="nav-number">2.3.12.</span> <span class="nav-text">AMD 模块注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#细节注释"><span class="nav-number">2.3.13.</span> <span class="nav-text">细节注释</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#语言特性"><span class="nav-number">3.</span> <span class="nav-text">语言特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#变量"><span class="nav-number">3.1.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件"><span class="nav-number">3.2.</span> <span class="nav-text">条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环"><span class="nav-number">3.3.</span> <span class="nav-text">循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类型"><span class="nav-number">3.4.</span> <span class="nav-text">类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类型检测"><span class="nav-number">3.4.1.</span> <span class="nav-text">类型检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类型转换"><span class="nav-number">3.4.2.</span> <span class="nav-text">类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串"><span class="nav-number">3.5.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对象"><span class="nav-number">3.6.</span> <span class="nav-text">对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组"><span class="nav-number">3.7.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">3.8.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数长度"><span class="nav-number">3.8.1.</span> <span class="nav-text">函数长度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参数设计"><span class="nav-number">3.8.2.</span> <span class="nav-text">参数设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#闭包"><span class="nav-number">3.8.3.</span> <span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#空函数"><span class="nav-number">3.8.4.</span> <span class="nav-text">空函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#面向对象"><span class="nav-number">3.9.</span> <span class="nav-text">面向对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态特性"><span class="nav-number">3.10.</span> <span class="nav-text">动态特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#eval"><span class="nav-number">3.10.1.</span> <span class="nav-text">eval</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态执行代码"><span class="nav-number">3.10.2.</span> <span class="nav-text">动态执行代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#with"><span class="nav-number">3.10.3.</span> <span class="nav-text">with</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete"><span class="nav-number">3.10.4.</span> <span class="nav-text">delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对象属性"><span class="nav-number">3.10.5.</span> <span class="nav-text">对象属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前后端分离思考"><span class="nav-number">4.</span> <span class="nav-text">前后端分离思考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#细节实现"><span class="nav-number">5.</span> <span class="nav-text">细节实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文献"><span class="nav-number">6.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Levy Li</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://miitbeian.gov.cn">湘ICP备15016908号</a>
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.0"></script>



  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.0"></script>



  



  



  
  

  
  


</body>
</html>
